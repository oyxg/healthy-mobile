<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>自定睡眠</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="css/sm.css">
    <link rel="stylesheet" href="css/my.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">

    <link rel="stylesheet" href="css/rili.css">
    <link rel="stylesheet" href="css/starability-all.min.css">

</head>
<body>
<div class="page-group">
    <!-- 你的html代码 -->
    <div class="page">
        <header class="bar bar-nav">
            <a class="button button-link button-nav pull-left back">
                <span class="icon icon-left"></span>
            </a>
            <h1 class="title">自定睡眠</h1>
        </header>
        <div class="content">
            <!-- 这里是页面内容区 -->
            <div class="date">
                <i class="fa fa-caret-left"></i>
                <input type="text" id="month" value="" />
                <i class="fa fa-calendar"></i>
                <i class="fa fa-caret-right max"></i>
            </div>
            <!--
            //用table 模拟出日期的效果
            //星期一,星期二,星期三,星期四,星期五,星期六,星期七
            //day1  day2 day3 day4  day5  day6  day7
            //day1  day2 day3 day4  day5  day6  day7
            //day1  day2 day3 day4  day5  day6  day7
            //day1  day2 day3 day4  day5  day6  day7
            //day1  day2 day3 day4  day5  day6  day7
            //day1  day2 day3 day4  day5  day6  day7
            -->
            <div class="aboluo">
                <div class="aboluo-leftdiv">
                    <div class="aboluo-rilidiv">
                        <table class="aboluo-rilitable" cellspacing="0" cellpadding="0" >
                            <thead class="aboluo-rilithead">
                            <tr>
                                <th>一</td>
                                <th>二</td>
                                <th>三</td>
                                <th>四</td>
                                <th>五</td>
                                <th style="color:red;">六</td>
                                <th style="color:red;">日</td>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
            <div class="list-block">
                <ul>
                    <li>
                        <label>您今天睡眠时间</label>
                        <input value="22 | 06" readonly />—
                        <input value="07 | 06" readonly />
                        <lable>9.0小时</lable>
                    </li>
                </ul>
            </div>
            <div class="list-block">
                <ul>
                    <li>
                        <label>您的睡眠质量</label>
                        <fieldset class="starability-basic">
                            <!---使用方法：要亮几颗星就在第几颗上加checked；另外：如果不想给让用户改变星星数量 下面的每个input 加上 disabled-->
                            <input type="radio" id="rate1" name="rating" value="5" />
                            <label for="rate1" title="">1 star</label>

                            <input type="radio" id="rate2" name="rating" value="4" checked="checked"  />
                            <label for="rate2" title="">2 stars</label>

                            <input type="radio" id="rate3" name="rating" value="3" />
                            <label for="rate3" title="">3 stars</label>

                            <input type="radio" id="rate4" name="rating" value="2" />
                            <label for="rate4" title="">4 stars</label>

                            <input type="radio" id="rate5" name="rating" value="1" />
                            <label for="rate5" title="">5 stars</label>
                        </fieldset>

                    </li>
                </ul>
            </div>
            <!-- 内容区结束 -->
        </div>
    </div>
</div>


<script type='text/javascript' src='js/zepto.js' charset='utf-8'></script>
<script type='text/javascript' src='js/sm.js' charset='utf-8'></script>
<!-- 需要用到日历时，请引入该文件,里面整理了相关函数 -->
<script type='text/javascript' src='js/rili.js' charset='utf-8'></script>

<script>
    $.init();

    // 页面加载完成后执行函数
    $(function(){

        //补零
        function add0(num) {
            return num <= 9 ? '0' + num : num;
        }

        var Nowtime=new Date();
        var currYear=add0(Nowtime.getFullYear());//今年
        var currMonth=add0(Nowtime.getMonth()+1);//当前月份
        //根据年，月，用table绘制日历。
        createTabledate(currYear,currMonth);
        //设置日历中每天的睡眠时长
        setSleepTimeByDay();


        //初始化当前年月
        $("#month").datePicker({
            value: [currYear, currMonth]
        });

        //初始化年月选项
        var yearArr = [];
        var monthArr = [];
        for(var i=0;i<=79;i++){
            yearArr.push(i+1970);
            if(currYear==i+1970){
                break;//最大年份为今年
            }
        }
        for(var i=0;i<12;i++){
            monthArr.push(i+1);
        }
        $("#month").picker({
            toolbarTemplate: '<header class="bar bar-nav">\
  <button class="button button-link pull-right close-picker">确定</button>\
  <h1 class="title">年月切换</h1>\
  </header>',
            cols: [
                {
                    textAlign: 'center',
                    values: yearArr
                },
                {
                    textAlign: 'center',
                    values: monthArr
                }
            ]
        });
        //切换到上个月（左箭头）
        $('i[class*="fa-caret-left"]').click(function(){
            var ym = $(this).nextAll('input').val();
            var y = parseInt(ym.substr(0,4));
            var m = parseInt(ym.substr(5,2))-1;
            y = add0(new Date(y,m,0).getFullYear());
            m = add0(new Date(y,m,0).getMonth()+1);
            if(y<=currYear && m<=currMonth){
                $(this).nextAll('i[class*="right"]').removeClass('max');
            }
            $(this).nextAll('input').datePicker({
                value: [y, m]
            });
            createTabledate(y,m);
            setSleepTimeByDay();
        });

        //切换到下个月（右箭头）
        $('i[class*="fa-caret-right"]').click(function(){
            var ym = $(this).prevAll('input').val();
            var y = parseInt(ym.substr(0,4));
            var m = parseInt(ym.substr(5,2))+1;
            y = add0(new Date(y,m,0).getFullYear());
            m = add0(new Date(y,m,0).getMonth()+1);
            if((y==currYear||y>currYear) && m>currMonth){
                $(this).addClass('max');
                $.alert('没有下个月的数据');
            }else{
                $(this).prevAll('input').datePicker({
                    value: [y, m]
                });
                createTabledate(y,m);
                setSleepTimeByDay();
            }
        });


        //遍历每天并通过匹配日期赋值
        function setSleepTimeByDay(){
            //模拟每日睡眠时长数据
            var obj = {'2016-9-9':'11.5','2016-9-8':'10.5'};
            $('td a').each(function(){
                for(var key in obj){
                    if(new Date(key).getTime()== new Date($(this).attr('date')).getTime()){
                        var html = '<p>'+$(this).html()+'</p>';//天
                        html += '<p>'+obj[key]+'</p>';//睡眠时长
                        $(this).html(html);
                    }
                }
            });
        }

    })
</script>
</body>
</html>